<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mental Gym – Compute Load Leaderboard</title>
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#0B1010;
      --panel:#0f1414;
      --panel-border:#13c1b1;
      --text:#f9fafb;
      --muted:#9fb3b0;
      --accent:#13c1b1;
      --accent-2:#0ea295;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
      font:16px/1.45 system-ui,Segoe UI,Roboto,Inter,-apple-system,BlinkMacSystemFont;}
    .screenwrap{
      min-height:100%;
      display:grid;
      place-items:center;
      padding:clamp(12px, 4vw, 24px);
    }
    .card{
      width:min(720px, 100%);
      background:linear-gradient(180deg,var(--panel),#0b1111);
      border:1px solid var(--panel-border);
      border-radius:16px;
      box-shadow:0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      padding:28px;
    }
    h1{margin:0 0 12px 0; font-size:26px; letter-spacing:.3px}
    p{margin:0 0 16px 0; color:var(--muted)}
    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
    }
    th,td{
      padding:8px;
      border-bottom:1px solid #1a2a2a;
      text-align:left;
      font-size:15px;
    }
    th{color:var(--muted); font-weight:500;}
    tr:nth-child(odd){background:rgba(255,255,255,0.02);}
    .btn{
      appearance:none;
      padding:10px 16px;
      border-radius:12px;
      border:1px solid transparent;
      background:#0c1414;
      color:var(--text);
      cursor:pointer;
      transition:transform .06s ease, border-color .15s ease, background .15s ease;
    }
    .btn:hover{border-color:#223b3b}
    .btn:active{transform:translateY(1px)}
    .btn.primary{
      background:var(--accent);
      color:#0B1010;
      font-weight:600;
    }
    .btn.primary:hover{
      background:var(--accent-2);
    }
    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:20px;}
  </style>
</head>
<body>
  <div class="screenwrap">
    <div class="card">
      <h1>Compute Load Leaderboard</h1>
      <p>Top 10 Compute Load scores across all players.</p>
      <div id="leaderboard">Loading…</div>
      <div class="actions">
        <button id="playBtn" class="btn primary">Play Compute Load</button>
      </div>
    </div>
  </div>

<script>
  (function(){
    const leaderboardDiv = document.getElementById('leaderboard');
    const playBtn = document.getElementById('playBtn');
    playBtn.onclick = () => { window.location.href = '/strength/compute-load/'; };
    async function loadLeaderboard(){
      try {
        const res = await fetch('/.netlify/functions/strength-leaderboard?limit=10');
        if (!res.ok) throw new Error('Error');
        const rows = await res.json();
        if (!Array.isArray(rows) || rows.length === 0) {
          leaderboardDiv.textContent = 'No scores yet.';
          return;
        }
        let html = '<table><thead><tr><th>#</th><th>Player</th><th>Best</th><th>Date</th></tr></thead><tbody>';
        rows.forEach((row, i) => {
          const date = new Date(row.updated_at);
          const dateStr = date.toLocaleDateString(undefined,{ year:'numeric', month:'short', day:'numeric' });
          html += `<tr><td>${i+1}</td><td>${row.email}</td><td>${row.best}</td><td>${dateStr}</td></tr>`;
        });
        html += '</tbody></table>';
        leaderboardDiv.innerHTML = html;
      } catch(err) {
        leaderboardDiv.textContent = 'Failed to load leaderboard.';
      }
    }
    loadLeaderboard();
  })();
</script>

<!-- AUTO-RESIZE SCRIPT (stable, no infinite growth) -->
<script>
(function () {
  try {
    if (window.parent !== window) {
      document.documentElement.style.height = "auto";
      document.body.style.height = "auto";
      var sw = document.querySelector(".screenwrap");
      if (sw) sw.style.minHeight = "auto";
    }
  } catch (e) {}

  function getContentHeight() {
    var card = document.querySelector(".card");
    var h = card ? Math.ceil(card.getBoundingClientRect().height) + 24 : document.body.scrollHeight;
    return h;
  }

  function postHeight() {
    var h = getContentHeight();
    try { parent.postMessage({ frame: "strength-leaderboard", height: h }, "*"); } catch (e) {}
  }

  window.addEventListener("load", postHeight);
  window.addEventListener("resize", postHeight);
  var ro = new ResizeObserver(postHeight);
  ro.observe(document.body);
})();
</script>

</body>
</html>